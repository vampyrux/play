<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>UK Monthly Retirement Income Projection</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial;
      max-width: 1000px;
      margin: auto;
      padding: 2em;
      background: #f4f7f8;
      color: #333;
    }
    .inputs {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1em;
    }
    label {
      display: block;
      margin-bottom: 0.5em;
    }
    input {
      width: 100%;
      padding: 0.4em;
    }
    .result {
      margin-top: 1em;
      background: #e0f7ea;
      padding: 1em;
      border-left: 4px solid #2ecc71;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 2em;
      background: white;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 0.4em 0.8em;
      text-align: right;
    }
    th {
      background: #2ecc71;
      color: white;
    }
    caption {
      text-align: left;
      font-weight: bold;
      margin-bottom: 0.5em;
    }
    #savingsChart {
      margin-top: 3em;
    }
  </style>
</head>
<body>
  <h1>UK Retirement Monthly Income Projection</h1>
  <div class="inputs">
    <label>Current Age: <input type="number" id="currentAge" value="30" min="18" max="70" /></label>
    <label>Retirement Age: <input type="number" id="retirementAge" value="57" min="50" max="75" /></label>
    <label>Current Savings (£): <input type="number" id="currentSavings" value="20000" min="0" /></label>
    <label>Monthly Contribution (£): <input type="number" id="monthlyContribution" value="500" min="0" /></label>
    <label>Annual Return (%): <input type="number" id="annualReturn" value="5" step="0.1" min="0" /></label>
    <label>Inflation (%): <input type="number" id="inflation" value="2" step="0.1" min="0" /></label>
    <label>Current Salary (£): <input type="number" id="currentSalary" value="40000" min="0" /></label>
    <label>Years Worked (by retirement - max 35): <input type="number" id="yearsWorked" value="30" min="0" max="50" /></label>
    <label>Target monthly income (£): <input type="number" id="targetMonthly" value="2400" min="0" /></label>
  </div>

  <div class="result" id="resultText"></div>
  <canvas id="savingsChart" width="800" height="300"></canvas>
  <div id="potTableContainer"></div>

<script>
function numberWithCommas(x) {
  return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}

let chart;

function update() {
  const age = +document.getElementById('currentAge').value;
  const retAge = +document.getElementById('retirementAge').value;
  const current = +document.getElementById('currentSavings').value;
  const contrib = +document.getElementById('monthlyContribution').value;
  const ret = +document.getElementById('annualReturn').value / 100;
  const infl = +document.getElementById('inflation').value / 100;
  const salary = +document.getElementById('currentSalary').value;
  const yrs = +document.getElementById('yearsWorked').value;
  const target = +document.getElementById('targetMonthly').value;

  const endAge = 90;
  const totalMonths = (endAge - age) * 12;
  const mRet = Math.pow(1 + ret, 1 / 12) - 1;

  const yearsToRetire = retAge - age;
  const finalSalary = salary * Math.pow(1 + infl, yearsToRetire);

  const companyAnnual = 0.01 * 0.8308 * finalSalary * yrs * 23 / (90 - retAge);
  const companyMonthlyGross = companyAnnual / 12;

  const statePensionWeekly = 230.25;
  const statePensionMonthlyGross = (statePensionWeekly * 52) / 12 / 35 * Math.max(yrs, 35);
  const taxFreeAllowance = 12570;

  let savings = current;
  let savingsAtRetirement = 0;
  let savingsFinal = 0;
  let savingsOverTime = [];
  let rows = [];

  for (let m = 0; m < totalMonths; m++) {
    const currAge = age + m / 12;
    const year = Math.floor(currAge);
    const monthsSinceRet = m - (retAge - age) * 12;
    const targetInflated = target * Math.pow(1 + infl, monthsSinceRet / 12);

    let stateGross = currAge >= 67 ? statePensionMonthlyGross : 0;
    let companyGross = currAge >= retAge ? companyMonthlyGross : 0;
    let totalGross = stateGross + companyGross;
    let annualGross = totalGross * 12;
    let taxable = Math.max(0, annualGross - taxFreeAllowance);
    let tax = taxable * 0.20 / 12;
    let coreNet = totalGross - tax;
    let drawings = 0;

    if (currAge < retAge) {
      savings = savings * (1 + mRet) + contrib;
    } else {
      drawings = Math.max(0, targetInflated - coreNet);
      savings = savings * (1 + mRet) - drawings;
    }

    if (m % 12 === 11) {
      savingsOverTime.push({ age: year, pot: Math.round(savings) });
      if (year >= retAge) {
        rows.push(`<tr><td>${year}</td><td>£${numberWithCommas(companyGross.toFixed(0))}</td><td>£${numberWithCommas(stateGross.toFixed(0))}</td><td>£${numberWithCommas(coreNet.toFixed(0))}</td><td>£${numberWithCommas((coreNet + drawings).toFixed(0))}</td><td>£${numberWithCommas(drawings.toFixed(0))}</td><td>£${numberWithCommas(savings.toFixed(0))}</td></tr>`);
      }
    }

    if (m === (retAge - age) * 12 - 1) {
      savingsAtRetirement = savings;
    }
  }
  savingsFinal = savings;

  document.getElementById('resultText').innerHTML = `
    <p>Retiring at <strong>${retAge}</strong>, projected final salary: <strong>£${numberWithCommas(finalSalary.toFixed(0))}</strong></p>
    <ul>
      <li>Target monthly income (inflation adjusted): £${numberWithCommas((target * Math.pow(1 + infl, yearsToRetire)).toFixed(0))}</li>
      <li>Company Pension (gross): £${numberWithCommas(companyMonthlyGross.toFixed(0))}/month from ${retAge}</li>
      <li>State Pension (gross): £${numberWithCommas(statePensionMonthlyGross.toFixed(0))}/month from 67</li>
      <li>Final savings pot at retirement: <strong>£${numberWithCommas(savingsAtRetirement.toFixed(0))}</strong></li>
      <li>Final savings pot at age 90: <strong>£${numberWithCommas(savingsFinal.toFixed(0))}</strong></li>
    </ul>
  `;

  const ctx = document.getElementById('savingsChart').getContext('2d');
  if (chart) chart.destroy();
  chart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: savingsOverTime.map(p => p.age),
      datasets: [{
        label: 'Savings Pot (£)',
        data: savingsOverTime.map(p => p.pot),
        borderColor: 'green',
        backgroundColor: 'rgba(46,204,113,0.2)',
        fill: true,
        tension: 0.1
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: {
          beginAtZero: false
        }
      }
    }
  });

  document.getElementById('potTableContainer').innerHTML = `
    <table>
      <caption>Annual Pension Overview from Age ${retAge}</caption>
      <thead>
        <tr>
          <th>Age</th>
          <th>Company Pension (Gross)</th>
          <th>State Pension (Gross)</th>
          <th>Total Core Pension (Net)</th>
          <th>Monthly Actual Pension</th>
          <th>Drawings per Month</th>
          <th>Savings Pot</th>
        </tr>
      </thead>
      <tbody>${rows.join('')}</tbody>
    </table>`;
}

document.querySelectorAll('input').forEach(input => {
  input.addEventListener('input', update);
});

update();
</script>
</body>
</html>
