<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>UK Monthly Retirement Income Model</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial; max-width:800px; margin:auto; padding:2em; background:#f4f7f8; color:#333;}
    .inputs { display:grid; grid-template-columns:1fr 1fr; gap:1em; }
    label { display:block; margin-bottom:0.5em; }
    input, select { width:100%; padding:0.4em; }
    .result { margin-top:1em; background:#e0f7ea; padding:1em; border-left:4px solid #2ecc71; }
    canvas { margin-top:2em; }
  </style>
</head>
<body>
<h1>UK Retirement Income Forecast Model</h1>
<div class="inputs">
  <label>Current Age: <input type="number" id="currentAge" value="30" min="18" max="70"></label>
  <label>Retirement Age: <input type="number" id="retirementAge" value="57" min="50" max="75"></label>
  <label>Current Savings (£): <input type="number" id="currentSavings" value="20000" min="0"></label>
  <label>Monthly Contribution (£): <input type="number" id="monthlyContribution" value="500" min="0"></label>
  <label>Annual Return (%): <input type="number" id="annualReturn" value="5" step="0.1" min="0"></label>
  <label>Inflation (%): <input type="number" id="inflation" value="2" step="0.1" min="0"></label>
  <label>Current Salary (£): <input type="number" id="currentSalary" value="40000" min="0"></label>
  <label>Years Worked (company pension accrual at retirement): <input type="number" id="yearsWorked" value="30" min="0" max="50"></label>
  <label>Target monthly income (£): <input type="number" id="targetMonthly" value="2400" min="0"></label>
</div>

<div class="result" id="resultText"></div>
<canvas id="chartIncome" height="100"></canvas>

<script>
const ctx = document.getElementById('chartIncome').getContext('2d');
const chart = new Chart(ctx, {
  type: 'line', data:{ labels:[], datasets:[{
    label:'Private monthly income projection (£)', data:[], borderColor:'#0077cc', backgroundColor:'rgba(0,119,204,0.1)', fill:true
  }]}, options:{ scales:{ x:{ title:{ display:true, text:'Age' }}, y:{ title:{ display:true, text:'£ / month' }, beginAtZero:true }}}
});

function update() {
  const age = +document.getElementById('currentAge').value;
  const retAge = +document.getElementById('retirementAge').value;
  const current = +document.getElementById('currentSavings').value;
  const contrib = +document.getElementById('monthlyContribution').value;
  const ret = +document.getElementById('annualReturn').value/100;
  const infl = +document.getElementById('inflation').value/100;
  const salary = +document.getElementById('currentSalary').value;
  const yrs = +document.getElementById('yearsWorked').value;
  const target = +document.getElementById('targetMonthly').value;

  const months = (retAge - age)*12;
  const mRet = Math.pow(1+ret,1/12)-1;
  const mInfl = Math.pow(1+infl,1/12)-1;
  let fv = current;
  chart.data.labels=[]; chart.data.datasets[0].data=[];

  for(let i=0;i<=months;i++){
    fv = fv*(1+mRet) + contrib;
    if(i%12===0) {
      const a = age + i/12;
      const monthlySalary = salary * Math.pow(1+infl,a-age);
      chart.data.labels.push(a);
      // income from private pot: assume 5% withdrawal
      chart.data.datasets[0].data.push((fv*0.05/12).toFixed(0));
    }
  }
  chart.update();

  // state pension begins at age 67
  const weeklySP = 230.25;
  const monthlySP = (age<67 && retAge<67) ? 0 : (retAge>=67 ? weeklySP*52/12 : 0);
  // company pension begins at retirement age, defined benefit at 1% per year final salary
  const finalSalary = salary * Math.pow(1+infl, retAge-age);
  const companyAnnual = (retAge>=retAge) ? 0.01*finalSalary*yrs : 0;
  const companyMonthly = companyAnnual/12;

  const privateMonthly = fv*0.05/12;
  const totalMonthly = privateMonthly + monthlySP + companyMonthly;
  const shortfall = target - totalMonthly;

  let html = `<p>If you retire at <strong>${retAge}</strong> years old:</p>`;
  html += `<ul>
    <li>State Pension scheduled: £${monthlySP.toFixed(0)}/month</li>
    <li>Company pension: £${companyMonthly.toFixed(0)}/month</li>
    <li>Projected private income: £${privateMonthly.toFixed(0)}/month</li>
    <li><strong>Total income</strong>: £${totalMonthly.toFixed(0)}/month</li>
    <li><strong>Target income</strong>: £${target.toFixed(0)}/month</li>
    <li><strong>Shortfall</strong>: £${(shortfall>0? shortfall:0).toFixed(0)} £/month</li>
    <li>${shortfall<0? "Surplus":"Gap needs to be covered"}</li>
  </ul>`;
  document.getElementById('resultText').innerHTML = html;
}

document.querySelectorAll('input').forEach(el=> el.addEventListener('input', update));
update();
</script>
</body>
</html>
