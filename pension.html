<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>UK Retirement Pension Projection Tool</title>
<style>
/* Reset and base */
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
  color: #e0e0e0;
  margin: 0;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 2rem 1rem;
}

/* Container for the whole app */
.container {
  max-width: 1200px;
  width: 100%;
  background: rgba(32, 50, 70, 0.8);
  border-radius: 16px;
  box-shadow:
    0 0 15px rgba(0, 255, 255, 0.3),
    inset 0 0 40px rgba(0, 255, 255, 0.1);
  padding: 2.5rem 3rem;
  backdrop-filter: blur(8px);
  border: 1px solid rgba(0, 255, 255, 0.15);
}

/* Headings with futuristic flair */
h1 {
  font-weight: 700;
  font-size: 2.8rem;
  color: #00fff7;
  letter-spacing: 0.12em;
  text-transform: uppercase;
  margin-bottom: 1rem;
  text-shadow:
    0 0 8px #00fff7,
    0 0 20px #00fff7;
  font-family: 'Orbitron', sans-serif;
}

h2 {
  font-family: 'Orbitron', sans-serif;
  font-weight: 600;
  color: #75f0f0;
  text-transform: uppercase;
  font-size: 1.5rem;
  margin-bottom: 1rem;
  border-bottom: 2px solid #00fff7;
  padding-bottom: 0.25rem;
  letter-spacing: 0.08em;
}

/* Form inputs styling */
.form-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: 1.8rem 2.5rem;
  margin-bottom: 3rem;
}

label {
  display: block;
  font-size: 0.9rem;
  font-weight: 500;
  margin-bottom: 0.35rem;
  color: #a4f0f0;
  letter-spacing: 0.06em;
}

input[type="number"], input[type="range"] {
  width: 100%;
  background: #142c3a;
  border: none;
  border-radius: 8px;
  color: #00fff7;
  padding: 0.5rem 0.75rem;
  font-size: 1rem;
  font-weight: 600;
  transition: box-shadow 0.3s ease;
  box-shadow: inset 0 0 6px #00fff7;
  font-family: 'Roboto Mono', monospace;
}

input[type="number"]:focus,
input[type="range"]:focus {
  outline: none;
  box-shadow:
    0 0 10px #00fff7,
    inset 0 0 10px #00fff7;
}

input[type="range"] {
  -webkit-appearance: none;
  height: 8px;
  border-radius: 8px;
  background: linear-gradient(90deg, #00fff7, #75f0f0);
  cursor: pointer;
}

input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 22px;
  height: 22px;
  background: #00fff7;
  border-radius: 50%;
  cursor: pointer;
  box-shadow: 0 0 8px #00fff7;
  transition: background 0.3s ease;
  margin-top: -7px;
}

input[type="range"]::-webkit-slider-thumb:hover {
  background: #75f0f0;
}

/* Output grid */
.output-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: 1.5rem 2rem;
  margin-bottom: 3rem;
}

.output-box {
  background: rgba(0, 255, 247, 0.15);
  border-radius: 12px;
  padding: 1.5rem 2rem;
  box-shadow:
    0 0 15px rgba(0, 255, 247, 0.3),
    inset 0 0 10px rgba(0, 255, 247, 0.1);
  transition: transform 0.3s ease;
  cursor: default;
}

.output-box:hover {
  transform: translateY(-5px);
  box-shadow:
    0 0 20px rgba(0, 255, 247, 0.6),
    inset 0 0 15px rgba(0, 255, 247, 0.2);
}

.output-title {
  font-family: 'Orbitron', sans-serif;
  font-weight: 700;
  color: #00fff7;
  font-size: 0.9rem;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  margin-bottom: 0.6rem;
}

.output-value {
  font-family: 'Roboto Mono', monospace;
  font-weight: 700;
  font-size: 1.6rem;
  color: #e0f7f7;
  text-shadow: 0 0 6px #00fff7;
}

/* Table styling */
table {
  width: 100%;
  border-collapse: collapse;
  font-family: 'Roboto Mono', monospace;
  font-size: 0.9rem;
  color: #b0e7e7;
  box-shadow: 0 0 30px rgba(0, 255, 247, 0.15);
  border-radius: 12px;
  overflow: hidden;
  background: linear-gradient(135deg, #142c3a, #203a43);
  margin-bottom: 2rem;
}

thead {
  background: #00fff7;
  color: #003333;
}

thead th {
  padding: 0.75rem 1rem;
  font-weight: 700;
  letter-spacing: 0.05em;
  text-transform: uppercase;
  border-bottom: 2px solid #00ccc3;
}

tbody tr {
  border-bottom: 1px solid rgba(0, 255, 247, 0.2);
  transition: background-color 0.3s ease;
}

tbody tr:hover {
  background: rgba(0, 255, 247, 0.1);
}

tbody td {
  padding: 0.6rem 1rem;
  text-align: center;
}

/* Chart container */
#chart-container {
  background: #142c3a;
  border-radius: 12px;
  padding: 1rem 1.5rem;
  box-shadow:
    0 0 20px rgba(0, 255, 247, 0.3),
    inset 0 0 15px rgba(0, 255, 247, 0.1);
  margin-bottom: 2.5rem;
}

/* Responsive tweaks */
@media (max-width: 768px) {
  .form-grid,
  .output-grid {
    grid-template-columns: 1fr;
  }
  
  h1 {
    font-size: 2rem;
  }
}

/* Import Orbitron font from Google Fonts */
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@600;700&family=Roboto+Mono:wght@600;700&display=swap');

</style>
</head>
<body>

<h1>Pension Projection Tool</h1>

<section aria-label="Input parameters">
  <form id="inputForm" class="input-grid" onsubmit="return false;">
    <div>
      <label for="currentAge">Current Age</label>
      <input type="number" id="currentAge" min="18" max="75" value="40" required />
    </div>
    <div>
      <label for="retirementAge">Retirement Age</label>
      <input type="number" id="retirementAge" min="57" max="75" value="67" required />
    </div>
    <div>
      <label for="currentSavings">Current Savings (£)</label>
      <input type="number" id="currentSavings" min="0" step="100" value="30000" required />
    </div>
    <div>
      <label for="monthlyContributions">Monthly Contributions (£)</label>
      <input type="number" id="monthlyContributions" min="0" step="10" value="500" required />
    </div>
    <div>
      <label for="investmentReturn">Expected Annual Investment Return (%)</label>
      <input type="number" id="investmentReturn" min="0" max="15" step="0.1" value="5" required />
    </div>
    <div>
      <label for="inflationRate">Expected Annual Inflation Rate (%)</label>
      <input type="number" id="inflationRate" min="0" max="10" step="0.1" value="2" required />
    </div>
    <div>
      <label for="currentSalary">Current Annual Salary (£)</label>
      <input type="number" id="currentSalary" min="0" step="1000" value="35000" required />
    </div>
    <div>
      <label for="employmentYear">Employment Start Year</label>
      <input type="number" id="employmentYear" min="1950" max="2025" step="1" value="2010" required />
    </div>
    <div>
      <label for="targetIncome">Target Monthly Income in Retirement (£)</label>
      <input type="number" id="targetIncome" min="0" step="100" value="2000" required />
    </div>
  </form>
</section>

<div id="retireLabel">at Retirement Age 67</div>

<section aria-label="Summary output">
  <div id="outputGrid"></div>
</section>

<section aria-label="Savings projection chart">
  <div id="chartContainer">
    <canvas id="savingsChart" width="960" height="400" role="img" aria-label="Line chart showing savings pot over age"></canvas>
  </div>
</section>

<section aria-label="Detailed yearly breakdown">
  <h2>Yearly Projection Breakdown</h2>
  <table role="grid" aria-describedby="retireLabel">
    <thead>
      <tr>
        <th scope="col">Age</th>
        <th scope="col">Company Pension (Gross)</th>
        <th scope="col">State Pension (Gross)</th>
        <th scope="col">Core Pension (Net)</th>
        <th scope="col">Total Monthly Income</th>
        <th scope="col">Drawings per Month</th>
        <th scope="col">Savings Pot (£)</th>
      </tr>
    </thead>
    <tbody id="breakdownBody"></tbody>
  </table>
</section>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
(() => {
  // Constants
  const PERSONAL_ALLOWANCE = 12570;
  const STATE_PENSION_START_AGE = 67;
  const MAX_STATE_PENSION_YEARS = 35;
  const MIN_COMPANY_PENSION_AGE = 57;
  const MAX_AGE = 90;

  // Elements
  const inputs = {
    currentAge: document.getElementById('currentAge'),
    retirementAge: document.getElementById('retirementAge'),
    currentSavings: document.getElementById('currentSavings'),
    monthlyContributions: document.getElementById('monthlyContributions'),
    investmentReturn: document.getElementById('investmentReturn'),
    inflationRate: document.getElementById('inflationRate'),
    currentSalary: document.getElementById('currentSalary'),
    employmentYear: document.getElementById('employmentYear'),
    targetIncome: document.getElementById('targetIncome'),
  };

  const outputGrid = document.getElementById('outputGrid');
  const breakdownBody = document.getElementById('breakdownBody');
  const retireLabel = document.getElementById('retireLabel');

  // Chart.js instance
  let savingsChart;

  // Utility: Format number with commas & optional decimals
  function fmt(num, decimals = 0) {
    if (isNaN(num) || num === null) return '-';
    return num.toLocaleString('en-GB', {
      minimumFractionDigits: decimals,
      maximumFractionDigits: decimals,
    });
  }

  // Clamp input values for validity
  function validateInputs() {
    let curAge = parseInt(inputs.currentAge.value, 10);
    let retAge = parseInt(inputs.retirementAge.value, 10);

    if (retAge < curAge) inputs.retirementAge.value = curAge;
    if (retAge < MIN_COMPANY_PENSION_AGE) inputs.retirementAge.value = MIN_COMPANY_PENSION_AGE;

    // Reparse after possible correction
    return {
      currentAge: parseInt(inputs.currentAge.value, 10),
      retirementAge: parseInt(inputs.retirementAge.value, 10),
      currentSavings: parseFloat(inputs.currentSavings.value),
      monthlyContributions: parseFloat(inputs.monthlyContributions.value),
      investmentReturn: parseFloat(inputs.investmentReturn.value) / 100,
      inflationRate: parseFloat(inputs.inflationRate.value) / 100,
      currentSalary: parseFloat(inputs.currentSalary.value),
      employmentYear: parseInt(inputs.employmentYear.value, 10),
      targetIncome: parseFloat(inputs.targetIncome.value),
    };
  }

  // Calculate inflation adjusted salary at retirement
  function calcInflationAdjustedSalary(salary, inflation, years) {
    return salary * Math.pow(1 + inflation, years);
  }

  // Calculate years worked capped at MAX_STATE_PENSION_YEARS
  function calcYearsWorked(currentYear, retirementAge, currentAge, employmentYear) {
    const yearsFromNowToRetire = retirementAge - currentAge;
    const totalYearsWorked = (currentYear + yearsFromNowToRetire) - employmentYear;
    return Math.min(MAX_STATE_PENSION_YEARS, Math.max(0, totalYearsWorked));
  }

  // Calculate company pension gross: Simple estimate
  // Assume company pension = 1/120th of final salary per year of service * years worked
  function calcCompanyPensionGross(finalSalary, yearsWorked) {
    return (yearsWorked / 120) * finalSalary * (90 - 67) / (90 - Math.max(retirementAge, MIN_COMPANY_PENSION_AGE));
  }

  // Calculate state pension gross: flat rate depending on years worked
  // Max full state pension ~£203.85/week (2023) scaled by years worked / max years
  function calcStatePensionGross(yearsWorked) {
    const fullWeekly = 203.85;
    const pensionWeekly = fullWeekly * (yearsWorked / MAX_STATE_PENSION_YEARS);
    return pensionWeekly * 52; // annual
  }

  // Apply 20% tax on income above personal allowance
  function netAfterTax(grossIncome) {
    const taxable = Math.max(0, grossIncome - PERSONAL_ALLOWANCE);
    const tax = taxable * 0.20;
    return grossIncome - tax;
  }

  // Calculate savings pot and drawdown each year from current age to MAX_AGE
  function calculateProjection() {
    const {
      currentAge,
      retirementAge,
      currentSavings,
      monthlyContributions,
      investmentReturn,
      inflationRate,
      currentSalary,
      employmentYear,
      targetIncome,
    } = validateInputs();

    const currentYear = new Date().getFullYear();
    const yearsToRetire = retirementAge - currentAge;

    // Adjust salary and target income for inflation until retirement
    const finalSalary = calcInflationAdjustedSalary(currentSalary, inflationRate, yearsToRetire);
    const targetMonthlyIncomeInflated = calcInflationAdjustedSalary(targetIncome * 12, inflationRate, yearsToRetire) / 12;

    // Calculate years worked for pensions
    const yearsWorked = calcYearsWorked(currentYear, retirementAge, currentAge, employmentYear);

    // Calculate pensions at retirement age
    const companyPensionGross = retirementAge >= MIN_COMPANY_PENSION_AGE
      ? calcCompanyPensionGross(finalSalary, yearsWorked)
      : 0;

    const statePensionGross = calcStatePensionGross(yearsWorked);

    // Prepare yearly projections from current age to MAX_AGE
    // Savings pot grows monthly pre-retirement, stops contributions at retirement
    // Drawdown starts at retirement to meet target income (targetMonthlyIncomeInflated)
    // Core pension income (company + state) starts at retirement & 67 respectively
    // Net pension after 20% tax on income above personal allowance

    let savingsPot = currentSavings;
    const monthlyReturn = Math.pow(1 + investmentReturn, 1/12) - 1;

    // Arrays for chart and table
    const ages = [];
    const savingsHistory = [];
    const tableData = [];

    // Annual target income and pensions (annualised)
    const targetAnnualIncome = targetMonthlyIncomeInflated * 12;

    for (let age = currentAge; age <= MAX_AGE; age++) {
      ages.push(age);

      if (age < retirementAge) {
        // Accumulate savings pot with monthly contributions and monthly returns
        // Approximate yearly growth by compounding monthly
        for (let m = 0; m < 12; m++) {
          savingsPot = savingsPot * (1 + monthlyReturn) + monthlyContributions;
        }
      } else {
        // Drawdown to cover shortfall between pensions and target income

        // Company pension only available if age >= retirementAge
        const compPension = age >= retirementAge ? companyPensionGross : 0;
        // State pension only starts at STATE_PENSION_START_AGE
        const statePension = age >= STATE_PENSION_START_AGE ? statePensionGross : 0;

        // Total annual pension gross
        const totalPensionGross = compPension + statePension;

        // Net pension income after tax
        const corePensionNet = netAfterTax(totalPensionGross);

        // Monthly net pension
        const corePensionMonthlyNet = corePensionNet / 12;

        // Shortfall to target income
        const shortfall = Math.max(0, targetMonthlyIncomeInflated - corePensionMonthlyNet);

        // Annual shortfall drawdown from savings pot
        const annualDrawdown = shortfall * 12;

        // Deplete savings pot
        savingsPot = Math.max(0, savingsPot * (1 + investmentReturn) - annualDrawdown);
      }

      savingsHistory.push(savingsPot);

      // Fill yearly table data
      const compPensionThisYear = age >= retirementAge ? companyPensionGross : 0;
      const statePensionThisYear = age >= STATE_PENSION_START_AGE ? statePensionGross : 0;
      const totalPensionGrossThisYear = compPensionThisYear + statePensionThisYear;
      const corePensionNetThisYear = netAfterTax(totalPensionGrossThisYear);
      const corePensionMonthlyNetThisYear = corePensionNetThisYear / 12;
      const monthlyDrawings = Math.max(0, targetMonthlyIncomeInflated - corePensionMonthlyNetThisYear);

      tableData.push({
        age,
        companyPensionGross: compPensionThisYear,
        statePensionGross: statePensionThisYear,
        corePensionNet: corePensionNetThisYear,
        totalMonthlyIncome: corePensionMonthlyNetThisYear + monthlyDrawings,
        monthlyDrawings,
        savingsPot,
      });
    }

    // Update retirement label
    retireLabel.textContent = `Projection at Retirement Age ${retirementAge}`;

    // Output summary boxes
    const totalContributions = monthlyContributions * 12 * yearsToRetire;
    const projectedPot = savingsHistory[yearsToRetire];
    const totalPensionsGrossAtRetirement = companyPensionGross + statePensionGross;
    const corePensionNetAtRetirement = netAfterTax(totalPensionsGrossAtRetirement);
    const monthlyDrawdownAtRetirement = Math.max(0, targetMonthlyIncomeInflated - (corePensionNetAtRetirement / 12));

    outputGrid.innerHTML = `
      <div class="output-box">
        <div class="output-title">Years Until Retirement</div>
        <div class="output-value">${yearsToRetire}</div>
      </div>
      <div class="output-box">
        <div class="output-title">Total Contributions (£)</div>
        <div class="output-value">£${fmt(totalContributions)}</div>
      </div>
      <div class="output-box">
        <div class="output-title">Projected Savings Pot at Retirement (£)</div>
        <div class="output-value">£${fmt(projectedPot)}</div>
      </div>
      <div class="output-box">
        <div class="output-title">Estimated Company Pension (Gross, Annual)</div>
        <div class="output-value">£${fmt(companyPensionGross)}</div>
      </div>
      <div class="output-box">
        <div class="output-title">Estimated State Pension (Gross, Annual)</div>
        <div class="output-value">£${fmt(statePensionGross)}</div>
      </div>
      <div class="output-box">
        <div class="output-title">Core Pension (Net, Annual)</div>
        <div class="output-value">£${fmt(corePensionNetAtRetirement)}</div>
      </div>
      <div class="output-box">
        <div class="output-title">Monthly Drawdown Required at Retirement</div>
        <div class="output-value">£${fmt(monthlyDrawdownAtRetirement)}</div>
      </div>
    `;

    // Update table rows
    breakdownBody.innerHTML = tableData.map(({ age, companyPensionGross, statePensionGross, corePensionNet, totalMonthlyIncome, monthlyDrawings, savingsPot }) =>
      `<tr>
        <td>${age}</td>
        <td>£${fmt(companyPensionGross)}</td>
        <td>£${fmt(statePensionGross)}</td>
        <td>£${fmt(corePensionNet)}</td>
        <td>£${fmt(totalMonthlyIncome)}</td>
        <td>£${fmt(monthlyDrawings)}</td>
        <td>£${fmt(savingsPot)}</td>
      </tr>`
    ).join('');

    // Chart update
    if (savingsChart) savingsChart.destroy();

    const ctx = document.getElementById('savingsChart').getContext('2d');
    savingsChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: ages,
        datasets: [
          {
            label: 'Savings Pot (£)',
            data: savingsHistory,
            fill: true,
            borderColor: 'rgba(34, 139, 34, 0.85)',
            backgroundColor: 'rgba(144, 238, 144, 0.4)',
            pointRadius: 0,
            borderWidth: 2,
            tension: 0.3,
          }
        ]
      },
      options: {
        responsive: true,
        interaction: {
          mode: 'index',
          intersect: false,
        },
        plugins: {
          legend: { labels: { color: '#004d00', font: { weight: 'bold' } } },
          tooltip: {
            enabled: true,
            backgroundColor: '#228B22',
            titleColor: '#e8f3e9',
            bodyColor: '#e8f3e9',
            callbacks: {
              label: ctx => `£${fmt(ctx.parsed.y)}`
            }
          }
        },
        scales: {
          x: {
            title: { display: true, text: 'Age', color: '#004d00', font: { weight: 'bold' } },
            ticks: { color: '#004d00' },
            grid: { color: 'rgba(34, 139, 34, 0.1)' }
          },
          y: {
            title: { display: true, text: 'Savings Pot (£)', color: '#004d00', font: { weight: 'bold' } },
            ticks: { color: '#004d00' },
            grid: { color: 'rgba(34, 139, 34, 0.1)' },
            beginAtZero: true,
          }
        }
      }
    });
  }

  // Attach event listeners to inputs for live updates
  Object.values(inputs).forEach(input => {
    input.addEventListener('input', () => {
      calculateProjection();
    });
  });

  // Initial calculation
  calculateProjection();

})();
</script>

</body>
</html>
